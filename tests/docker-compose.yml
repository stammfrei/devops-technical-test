---
version: "3.8"

services:
  wordpress:
    image: "wordpress:6.3.1"
    user: root
    networks:
      - wp
      - db
    volumes:
      - type: "bind"
        source: "${PWD}/www"
        target: "/var/www/html"
    environment:
      # WORDPRESS_DB_NAME: "${DATABASE_NAME}"
      # WORDPRESS_DB_USER: "${DATABASE_USER}"
      # WORDPRESS_DB_PASSWORD: "${DATABASE_PASSWORD}"
      # WORDPRESS_DB_HOST: "mariadb"
      # WORDPRESS_DB_CHARSET: "utf8"
      # WORDPRESS_DB_COLLATE: ""
      # WORDPRESS_TABLE_PREFIX: "wp_"
      # WORDPRESS_DEBUG: "true"
      WP_DB_NAME: "${DATABASE_NAME}"
      WP_DB_USER: "${DATABASE_USER}"
      WP_DB_PASSWORD: "${DATABASE_PASSWORD}"
      WP_DB_HOST: "mariadb"
      WP_DB_CHARSET: "utf8"
      WP_DB_COLLATE: ""
      WP_TABLE_PREFIX: "wp_"
      WP_DEBUG: "true"
      # We let it empty, so wordpress will fill them
      # WP_AUTH_KEY: ""
      # WP_SECURE_AUTH_KEY: ""
      # WP_LOGGED_IN_KEY: ""
      # WP_NONCE_KEY: ""
      # WP_AUTH_SALT: ""
      # WP_SECURE_AUTH_SALT: ""
      # WP_LOGGED_IN_SALT: ""
      # WP_NONCE_SALT: ""

      # I use nginx to server the static files
      # since traefik don't support static files as far as I know
  nginx:
    image: "nginx"
    user: root
    networks:
      - "wp"
    environment:
      WP_HOST: "wordpress"
      WP_PORT: "9000"
    ports:
      - "8080:80"
    volumes:
      - type: "bind"
        source: "${PWD}/nginx.conf"
        target: "/etc/nginx/nginx.conf"
        read_only: true
      - type: "bind"
        source: "${PWD}/www"
        target: "/var/www/html"

  mariadb:
    image: "mariadb:11"
    networks:
      - "db"
    environment:
      MARIADB_ROOT_PASSWORD: "${DATABASE_ROOT_PASSWORD}"
      MARIADB_DATABASE: "${DATABASE_NAME}"
      MARIADB_USER: "${DATABASE_USER}"
      MARIADB_PASSWORD: "${DATABASE_PASSWORD}"

volumes:
  wp:


networks:
  wp:
  db:
